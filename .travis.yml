language: java

jdk: openjdk11

cache:
  directories:
    - ".autoconf"
    - "$HOME/.m2"

#Enable travis to use docker
services:
  - docker

#Set env variables.
env:
  global:
    - GCP_PROJECT_ID=exam-295817
    - IMAGE=gcr.io/exam-295817/helloworld
    - CLOUD_RUN_SERVICE=helloservice
    - CLOUD_RUN_REGION=us-central1
    #Disable cloud from asking us about input
    - CLOUDSDK_CORE_DISABLE_PROMPTS=1
    - secure: xdYW2GSmmjTOjYvWP8TZeICcka2zVDX8/zSc5hPwWmXByjrVLlL3cYg4ewNJbq+B4bNOs75eBCPWWT/JEILEmRIN5ZuGNGWw0uS6pwP3ugRLZ4SCxcM4pTAuEbpx8dgazlPQj35gAj5LTx9B8rQEVneOnpRCkFgtHdEoff5jLHTjpv/ge/jUp8UXYa7rwdMj9iUTrbV5n7jozPXH91nq12DGfgmCP9iQKcGFE3l6DWPJKHooCk1YfV8YOe+Bg/GCL5+PVklKtaTMd+aJFdGrByGMsMpywGFseu+nGEnOne6Y76VqnQdHDMp+EFhtRvCh4O5ZUzTOhKkz6Q1OlMIV8ieINNSgwrNB9cD49isANlXAj+r3Ovx2tqtW2kfvjXlW1a1IwWf/wk9zqOQw0TA2/h2KE9GK15Ue1XoJwBNLMERNLK0nOIR/XlpCXNqxUAO3G61ThaozUP1uYufdiCVT3dZT/JpAnxUTCQjMqFozq7s0xL6JKweZpQxiXSUdafUWVhhtjcVAD8BVxvCE0pl32ztJueakMgN45ju++BpArZ2VOfQL0DlTljOPMYuvZl8kjtcOyOr/hdlcU+Tkd1yQv5wCVhL6f7cI6fw8vhxdMkeRor1jeaviOrw9+Q2R5oordYs2ZDFypszNeT/Iv7bg6dBYoDqU7DeAlhUeBUPlmi4=
    - secure: QUY5Z2bKkfiGL+6XWSFGaRyIvRIfGVspRPqKmHhM9TXRsS2p8dxyo9+VkEnsPD1r2SmtEMONic8z5A4z5DI1sggLbrH8KozWlSO2PFlQhpryKKqguEoNRaEv88E5kozE8kwxzxyYFqh83ApoomCd2hyK1n3aiWset+rKXE+VFrpSvNBGmWMFxKydljeN0SQsVZqVGNYKV4ld3XGRveWJm0hlQDwGjxhcr2jNPpXDAM2d/2aJEAetLBFNw9SKuKAoyFxRyv8E7OaM991zV2+iYQWtKoHCFzpAvdJaRmNkwgk2f2g/aVRsZvU/vYNWc6MmWnySh2ruEC5NL39Me4/tdJXMoBKOnf9h/lX3b978yCcQa6n2o9+7eEUdHOcoTcPr8hS2WW0kG2udlu8Fo7nQKWMa0bAtBroA2USaeXV96G/SYo3F4W1fi3dI0GpPVBZQucGI5vdZWUb2B7UdehwCRefH1yKtD54Www9D2AuDuFhprahOW9Ve3gjSLEDtR1qRk0VPUy4jUB7W72wom4aZtSrCWmf855H9FV2gwaz2mO2ASkMstBRxPXsbJabyGy44v+DbCfl8Yqe04wKOyGSGlp04KIBi2Imnh4kryDN+SR1wnSrP/nXDaAOXRYc/GtdIJzzMN8GT+EUU8dIo6R8Q9iRZ6xYMWNLdNcmPxZ0vdGc=


before_install:
  #Google service account JSON file which is encrypted by "travis encrypt-file"
  #Travis will decrypt this and do the remaining build process
  - openssl aes-256-cbc -K $encrypted_98d237b7dbf4_key -iv $encrypted_98d237b7dbf4_iv -in google-key.json.enc -out google-key.json -d
  #Download google cloud sdk and install it
  - curl https://sdk.cloud.google.com | bash > /dev/null
  - source "$HOME/google-cloud-sdk/path.bash.inc"
  #Use the encrypted file for activating google service account.
  - gcloud auth activate-service-account --key-file=google-key.json
  - gcloud auth configure-docker
  - gcloud config set project "${GCP_PROJECT_ID}"


#Push particular branch to remote registry after tests succeeds
deploy:
  provider: script
  script: bash ./travis/docker_push
  on:
    branch: main
