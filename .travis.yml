language: java

jdk: openjdk11

cache:
  directories:
    - ".autoconf"
    - "$HOME/.m2"

#Enable travis to use docker
services:
  - docker

#Set env variables.
env:
  global:
    - GCP_PROJECT_ID=exam-295817
    - IMAGE=gcr.io/exam-295817/helloworld
    - CLOUD_RUN_SERVICE=helloservice
    - CLOUD_RUN_REGION=us-central1
    #Disable cloud from asking us about input
    - CLOUDSDK_CORE_DISABLE_PROMPTS=1
    - secure: U4QFV94vuN73OlYakHLcEuwlCJm4QYLfFz8weST0l7FJa/BL7+xWIxBSLMeuCJwBr/busPhxAh2ib/FFDoUHchQIN4lDKlwitCgkTZLqyZTYoJTWI2YtxiNloIaaXYdKjhD0vRdhgiP/bQa4mqFbfvaEqP1cuPZ1nrUbxQhD03rS876sfaLdMyP8vcZ2NJtZOuHM2baUDGDvbfObC0LJgQkbA1ZdFZvwuW8eKYHqRcdg/6AaoDjy1TnGkfz6dFl6K8preCQJP3E88EKJYYp0kc3s42ocSfaVwQeYAgdiv1syMTB73EZcaSe+WArF13GiwQbAkYhmiL+vhbFyg7lgKG/M21Y6Tvk65N0Ke1Q1TX3tmeiZ/1o4BpkCKIy54Bfjaz3XvSzqJ235bG4P7XvQUbOmt56/FuXnDe4K21wzznAjaO5lO0IIiR3iemEorX8UVmWldErfnZOEzYdVC5kTHLgRu8D0VTFbjQRtgkXBcfeEKMj2OGqENJuzbuesnSuCMicXnSWXuxNcKR1eyacr12pDmslZwVfPiuHFDUriFeNxnDRG0ONeY6ZQuO8XY1glUo655vbwMQ1eHqn+jFyvOF09S/GP9qCLutuW3KDrFa173WOqeJQUch5EDR37I1K92t42G6PHFIzbWtw9kh8Zdgn71ZW3f2H1t0ayOPQDeC8=
    - secure: pWNykqAHqtVFqPrW9YrW6z7q4FL+eJVos23guSbNPXoM45P7XijxtWnj+sp096g+Nmy0YHhw0c2YMGGDqp4ZurxwLdrMfGj8AE/Ag2y89Vc90EGm/X9nCRW7IbEnh1kBY9pEnpxqzZeFfnAy0q8GgW5eM3Gh0M0LwXIhvfrYU4VviXCvccOU5aw9eZDQ+oJvwbWuMSaNpZyCs8SNA2YLOmUj2V889rvtGNKmqoC2/buWaNEFmwIp4FJhttdP2/jaNXQxMo46gvMn6PMYGRE8sqTyGs/o1KwN9wR+AIigW0L+TgzS6i/BDjlNpmATJoNM6o63NbSEE5Wet9hWhXnH10QklsfF52w4961FNrrHeWlaB8Jhsik5/n7VO9brKrcinxXLjEmjCY3GKrepqlWZuMyMwqQYRUpPES/yIa1NBmcZQkYGwjPzgJv776qEgqPv1aA320w99KElP7+Ldbc4vMZXz5Kaq/6QOouCVJlhkV0jZOm1RWkuypCf+o71vbV6aoSaOmdv7qu2MpP2iBHvEBiX0j6SK+a1eYmiX8SXtvE0aaYUImY3qU3Q2NPCxYPHrR4piQ1rk9lpjtC0p47YkGkDisNmb6x+5XH2ASCCifbrTFSLkw2KWp46E8aHMH6r63BjrDXzjFPghOG4Sw5TXUySWcV94PKa7h8zmbRLB/k=


before_install:
  #Google service account JSON file which is encrypted by "travis encrypt-file"
  #Travis will decrypt this and do the remaining build process
  - openssl aes-256-cbc -K $encrypted_98d237b7dbf4_key -iv $encrypted_98d237b7dbf4_iv -in google-key.json.enc -out google-key.json -d
  #Download google cloud sdk and install it
  - curl https://sdk.cloud.google.com | bash > /dev/null
  - source "$HOME/google-cloud-sdk/path.bash.inc"
  #Use the encrypted file for activating google service account.
  - gcloud auth activate-service-account --key-file=google-key.json
  - gcloud auth configure-docker
  - gcloud config set project "${GCP_PROJECT_ID}"


#Push particular branch to remote registry after tests succeeds
deploy:
  provider: script
  script: bash ./travis/docker_push
  on:
    branch: main
