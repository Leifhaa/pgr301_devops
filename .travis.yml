language: java

jdk: openjdk11

cache:
  directories:
    - ".autoconf"
    - "$HOME/.m2"

#Enable travis to use docker
services:
  - docker

#Set env variables (Only available during build process).
env:
  global:
    - GCP_PROJECT_ID=exam-295817
    - IMAGE=gcr.io/exam-295817/helloworld
    - CLOUD_RUN_SERVICE=helloservice
    - CLOUD_RUN_REGION=us-central1
    #Disable cloud from asking us about input
    - CLOUDSDK_CORE_DISABLE_PROMPTS=1
    - secure: fcj7xG5jD6hlr4cszlzQCRPlPa3QikSxlbTUvBFwgTy1Svr7snI9k/hZKePw/5Lcc77zcQD8sWp0O3IjKaVufNTDokpY9iZ2I9wUYFm1MvtFlE9ZD9RnooZqFIljIyT0nh7zg56FPu21aTGpfI2/glTiyUD7HgDmN9tiOPDnWAbEF9Dq7G7u9OSp/PktWF3J3RNuu5cX2/WQfiTZNHvoDV5ME6PNkb/osU5DuifiMe6lXDP5mAcLvndffvBE78O2HedH6YFeEtuZX/0pk2/iHvB/OnAiKCLF4N/p4GmVKew0J5lqrBCjBzm4nIF/0ucfEM0+7qM/WUvqOlg6M0JY4D1m3a2AaBe0KVBHai8TXK5kcIUCpBD01sCOUThBK1bijEUjHMK5AjJHZyXIXG/SbBdg4GApHsp9CDObet04T4T6Q00tU6SyTwg5/mkxYkVbVjszgkcux3Fu0QiczMTgounwv3hJU00svwbo8WyW+ElKforSz+bGEq1sft+G3uDz268xG9/ZeQtGlKG9OH6845Z1e2xXeMJ0r7IUlubPO9pa/kVpvLrO1j+Fk2MLavxWspkIM8FH8uaCBU85LkDTuWHDulP1lGD6s4bP7d9ZrQULBhYUd1KP9yPtl2Eg8liTQcp1a/kNknULJ9yxQhSWFZCCpsS+VtjgBjGtggEU7tE=
    - secure: yOMmI2oXLDeiDdCUALBDuti3zBsVgQ3zQ/DZA5cZKaIXBunj0KDXH9usQC57wesW5fpB/gNr7/+Zsrxk5uIaCJNETCoWYB7jL0QlVTETMTOJmIDSDlScTIHtpqJSRY31kOr1W8d2RPo6Wan0+dyYjpVG+38mpahkrOUkQq0f5yaKOC4yAcWhfRhQ9x5szXyT/Bz5XShLSKZaX99uWFO9mZSyvFRqPitXjDi1wVCIIM2Ajr1dxErJqdGeSzCon1mgi/kbccApDpLWe6ykZff6lX4Wocg2nW2udwxWKCNDMt7qpz9l/llU10gejbqGje4FboE6lX4mNOW/7oZxC1keG4ddL5OTb92VCCjfCRgc9cqnZ4UOxADXt0dfBpW2Aal5DVC2+TSWxJbGn6DTCkLXfleptwtMi/YaQg6rskB8e7rn97nhLzO4DIhM4RuU4BBJeE8P43lzxg+eULb7esLgN3LG8Tm9cyuXGZy6PhswF5X1sDhHkDRAozpTBZHkLWtUSRpEgYjSXdnZ7DQV/f95y4SxZKKT8dho3ES9E3BCBRFZ23NgpQLQGSpuro4JR6pRBYj0kbc6yHI39wwg6QclzjSyEFMkE5k474Hq7aW9e6HiP4u7FDQwrevkNRSVacXmIx9banz/ya23mAMo1U+1bmTZk3jWWyLwUgCpNveUCuc=


before_install:
  #Google service account JSON file which is encrypted by "travis encrypt-file"
  #Travis will decrypt this and do the remaining build process
  - openssl aes-256-cbc -K $encrypted_98d237b7dbf4_key -iv $encrypted_98d237b7dbf4_iv -in google-key.json.enc -out google-key.json -d
  #Download google cloud sdk and install it
  - curl https://sdk.cloud.google.com | bash > /dev/null
  - source "$HOME/google-cloud-sdk/path.bash.inc"
  #Use the encrypted file for activating google service account.
  - gcloud auth activate-service-account --key-file=google-key.json
  - gcloud auth configure-docker
  - gcloud config set project "${GCP_PROJECT_ID}"


#Push particular branch to remote registry after tests succeeds
deploy:
  provider: script
  script: bash ./travis/docker_push
  on:
    branch: main
